<!DOCTYPE html><html lang="en"><head><title>README-dev</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content=""><meta name="groc-document-path" content="README-dev"><meta name="groc-project-path" content="README-dev.md"><link rel="stylesheet" type="text/css" media="all" href="assets/style.css"><script type="text/javascript" src="assets/behavior.js"></script><body><div id="meta"><div class="file-path">README-dev.md</div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><h1 id="unicorn-dev-guide">Unicorn dev guide</h1>
<h2 id="introduction">Introduction</h2>
<p>The purpose of this document is to provide a high level understanding of the design and implementation for Unicorn. The document is intended for developers who want to understand and extend the platform features.</p>
<h2 id="system-overview">System overview</h2>
<p>The current build system is <a href="http://yui.github.io/shifter/">Shifter</a>. It have not had any change or improvement in long time. The decision was to create our own build tool.</p>
<p>The scope of the project is to create a new build tool that is backward compatible with Shifter but faster and easier to maintain.</p>
<p>The tool is a <a href="https://nodejs.org/en/">nodejs</a> module that can be executed through command line or imported by another module.</p>
<h6 id="features">Features:</h6>
<ul>
<li>Wrap the code with YUI().use(), YUI.add() or nothing depending on the module configuration.</li>
<li>Rollup creation.</li>
<li>Linting with JS linter (JSHint or ESLint) and CSSLint.</li>
<li>Minification for JS, CSS and i18n files.</li>
<li>Watch functionality to build on changes.</li>
</ul>
<h2 id="usage">Usage</h2>
<ul>
<li>Command line</li>
</ul>
<p>A node module needs to have a bin file to be executed on the terminal. The package.json file has the following attribute:</p>
<pre><code>&quot;bin&quot;: {
  &quot;unicorn &quot;./bin/unicorn&quot;
}</code></pre>
<p>This means that when executing <code>unicorn</code> on the terminal the script <code>bin/unicorn</code> will be executed.</p>
<ul>
<li>Import in another module</li>
</ul>
<p>Unicorn has a cli for other modules to access all the features provided. Add the following code your JS file:</p>
<pre><code>ES5
var unicorn = require(&#39;unicorn-tool/lib/cli&#39;);

ES6
import unicorn from &quot;unicorn-tool/lib/cli&quot;;</code></pre>
<h2 id="under-the-hood">Under the hood</h2>
<p>The only entry point is the <code>lib/cli.js</code> file. The <code>compile</code> function will receive the options set by the user and start the configuration:</p>
<ul>
<li>Search for .shifter.json</li>
<li>Search for .jshintrc or .eslintrc.</li>
<li>Setting logging level.</li>
<li>Set the output path.</li>
<li>Enable/disable CSSlint nad/or JSHint/ESLint.</li>
<li>Load all the configuration to the builder.</li>
<li>Start the build<ul>
<li>Watch</li>
<li>Full build</li>
<li>Build module</li>
</ul>
</li>
</ul>
<p>The builder (<code>lib/builder.js</code>) is in charge of the build process. Due to a backward compatibility requirement the <code>meta-data</code> and <code>build.json</code> is loaded for each module. Once we have all the properties for the modules the actual build can start:</p>
<ul>
<li>Remove the output path.</li>
<li>Find the files to build.</li>
<li>Pre-execute scripts.</li>
<li>Wrap the source and write the output.</li>
<li>Post-execute scripts.</li>
<li>Copy the assets under the assets/ folder, if any.</li>
<li>Create the rollups.</li>
</ul>
<p>The templates are using <a href="http://olado.github.io/doT/index.html">DoT</a> engine. They are under <code>lib/template/</code> folder. The templates are pre-compiled to increase the performance. Compiling them is as easy as running <code>grunt</code>. This is going to generate a <code>lib/templates.js</code> file that is imported to the builder.</p>
<h6 id="js">JS</h6>
<ul>
<li>Concatenate the JS files mentioned on the <code>build.json</code>.</li>
<li>Call the template for <code>use</code> or <code>add</code>.</li>
<li>Prepend files.</li>
<li>Append files.</li>
<li>Replace values specified on the <code>.shifter.json</code> files as <code>replace--XXX</code>.</li>
<li>Run JS lint.</li>
<li>Create the debug version of the JS module.</li>
<li>Run the regex to remove logging.</li>
<li>Create the raw and the minify version of the JS module.</li>
<li>Create the lang files, if any.</li>
<li>Create the skin, if any.</li>
</ul>
<h6 id="css">CSS</h6>
<ul>
<li>Concatenate the CSS files mentioned on the <code>build.json</code>.</li>
<li>Replace values specified on the <code>.shifter.json</code> files as <code>replace--XXX</code>.</li>
<li>Run CSSLint.</li>
<li>Run uglify-css.</li>
<li>Write the raw and minify version.</li>
</ul>
<h6 id="skin">Skin</h6>
<ul>
<li>Find and read the core css file, if any.</li>
<li>Append the core css to all the skins and treat it as a css file.</li>
</ul>
<h2 id="js-lint-and-csslint">JS Lint and CSSLint</h2>
<p><code>JSHint</code> is the linter used by default.</p>
<p>The linters are not manually selected. The tool searches for the configuration files on the working directory:</p>
<ul>
<li>ESLint uses <code>.eslintrc</code>.</li>
<li>JSHint uses <code>.jshintrc</code>.</li>
</ul>
<p><code>ESlint</code> has higher priority. This means that if the file <code>.eslintrc</code> is found <code>ESLint</code> is used, otherwise JSHint is used.</p>
<h6 id="reporters">Reporters</h6>
<p>These linters modules are being executed using they API and not the binary. That is why custom reporters are needed. The folder <code>lib/lint/reporters</code> contains terminal level reporters.</p>
<p>If another type of report is needed a new module can be created taking into consideration the information provided by the third party modules:</p>
<ul>
<li><a href="https://github.com/CSSLint/csslint/wiki/Using-in-a-Node.js-Application">CSSLint</a></li>
<li><a href="http://jshint.com/docs/api/">JSHint</a></li>
<li><a href="http://eslint.org/docs/developer-guide/nodejs-api">ESLint</a></li>
</ul>
<p>Finally change the reporters used by the lint module.</p>
<h2 id="testing">Testing</h2>
<p>The unit test are based on <a href="https://mochajs.org/">Mochajs</a>, <a href="http://chaijs.com/">Chai</a> and <a href="http://sinonjs.org/">Sinon</a>.</p>
<p>Running the test is as simple as <code>grunt test</code>.</p>
<p>All the unit test are located in <code>tests/js</code> folder. There are two modules that work as mock scenarios to test the tool (module and dragon). The mock folder contains separate files to test specific scenarios for the writer.</p>
<h2 id="documentation">Documentation</h2>
<p>Documentation is based on <a href="https://github.com/nevir/groc">Groc</a>. It is not an API documentation but source code documentation. It is mean to be used by developer to understand what the code is doing and not how to interact as a third party module.</p>
<p>Generating the documentation is as simple as <code>grunt docs</code>. The output path is <code>docs/</code>.</p></div></div></div></div></body></html>